services:
  editor_service_api:
    build:
      context: ./api
      target: dev
    environment:
      PORT: ${EDITOR_SERVICE_PORT}
      SERVICE_ROUTE: ${SERVICE_ROUTE}
      USER_SERVICE_API: 'http://user_service_api:9000/user-service'
      ROOM_SERVICE_API: 'http://room_service_api:9003/room-service'
      QUESTION_SERVICE_API: 'http://question_service_api:9001/question-service'
      REDIS_PORT: ${REDIS_PORT}
      REDIS_HOST: 'editor_service_redis'
    ports:
      - '${EDITOR_SERVICE_PORT}:9004'
    networks:
      - peerprep_network
    depends_on:
      - editor_service_redis
    restart: unless-stopped
    volumes:
      - ./api/node_modules:/editor_service_api/node_modules
      - ./api/src:/editor_service_api/src

  editor_service_docs:
    build:
      context: ./docs
      target: dev
    environment:
      PORT: ${EDITOR_DOCS_PORT}
      DOCS_SERVICE_ROUTE: ${DOCS_SERVICE_ROUTE}
      REDIS_PORT: ${REDIS_PORT}
      REDIS_HOST: 'editor_service_redis'
      QUESTION_SERVICE_API: 'http://question_service_api:9001/question-service'
      MQ_USER: ${MQ_USER}
      MQ_PASSWORD: ${MQ_PASSWORD}
      MQ_HOST: 'room_service_mq'
      MQ_EXCHANGE_NAME: ${MQ_EXCHANGE_NAME}
      MQ_QUEUE_NAME: ${MQ_QUEUE_NAME}
      NODE_ENV: ${NODE_ENV}
    networks:
      - peerprep_network
    ports:
      - '${EDITOR_DOCS_PORT}:${EDITOR_DOCS_PORT}'
    depends_on:
      - editor_service_redis
    restart: unless-stopped
    volumes:
      - ./docs/node_modules:/editor_service_docs/node_modules
      - ./docs/src:/editor_service_docs/src

  editor_service_redis:
    image: redis:7-bookworm
    ports:
      - '${REDIS_PORT}:${REDIS_DOCKER_PORT}'
    networks:
      - peerprep_network
    command: /bin/sh -c "redis-server --requirepass ${REDIS_PASSWORD}"
    restart: unless-stopped

networks:
  peerprep_network:
      external: true
      name: peerprep
